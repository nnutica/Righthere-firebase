<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Firebasemauiapp.Mainpages.DiaryView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="DiaryView"
    BackgroundColor="#FFDEFDBF"
    Shell.NavBarIsVisible="False">
    <VerticalStackLayout Padding="20"
            Spacing="12">



        <!--  Entry Field  -->
        <Frame
            Margin="0,0,0,10"
            Padding="10"
            BackgroundColor="#F8FAED"
            CornerRadius="20"
            HasShadow="True"
            Opacity="30"
            BorderColor="#50A65D"
            WidthRequest="350">
            <Editor
                x:Name="DiaryEntry"
                BackgroundColor="#F8FAED"
                HeightRequest="300"
                Placeholder="share something good..."
                Text="{Binding DiaryContent}"
                TextColor="Black"
                VerticalOptions="Start"
                VerticalTextAlignment="Start"
                WidthRequest="330"/>
        </Frame>

        <!-- Selected image preview (optional) -->
        <Image Source="{Binding ImageUrl}"
               HeightRequest="220"
               Aspect="AspectFill"
               IsVisible="True">
            <Image.Triggers>
                <DataTrigger TargetType="Image"
                        Binding="{Binding ImageUrl}"
                        Value="">
                    <Setter Property="IsVisible"
                            Value="False"/>
                </DataTrigger>
                <DataTrigger TargetType="Image"
                        Binding="{Binding ImageUrl}"
                        Value="{x:Null}">
                    <Setter Property="IsVisible"
                            Value="False"/>
                </DataTrigger>
            </Image.Triggers>
        </Image>

        <!-- Upload row: + button and spinner -->
        <Grid ColumnDefinitions="Auto,Auto,*"
                VerticalOptions="Start">
            <Button Text="+"
                    Command="{Binding UploadImageCommand}"
                    BackgroundColor="#FEAA3A"
                    TextColor="White"
                    WidthRequest="44"
                    HeightRequest="44"
                    CornerRadius="12"/>
            <ActivityIndicator Grid.Column="1"
                               Margin="12,0,0,0"
                               Color="#50A65D"
                               IsRunning="{Binding IsUploadingImage}"
                               IsVisible="{Binding IsUploadingImage}"/>
        </Grid>

        <!--  ✅ Loading Indicator  -->
        <ActivityIndicator
            x:Name="LoadingIndicator"
            Margin="10"
            Color="Blue"
            IsRunning="{Binding IsLoadingVisible}"
            IsVisible="{Binding IsLoadingVisible}"/>

        <!--  ✅ ปุ่ม Next  -->
        <Button
            x:Name="AnalyzeButton"
            Margin="0,200,0,120"
            BackgroundColor="#50A65D"
            Command="{Binding AnalyzeContentCommand}"
            FontSize="16"
            VerticalOptions="End"
            HorizontalOptions="End"
            IsEnabled="{Binding IsAnalyzing, Converter={StaticResource InvertedBoolConverter}}"
            Text="{Binding AnalyzeButtonText}"
            TextColor="White"/>
    </VerticalStackLayout>
</ContentPage>