<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Firebasemauiapp.Mainpages.SelectMoodPage"
             Shell.NavBarIsVisible="False"
             Title="Select Mood">
    <Grid RowDefinitions="*,32"
          Padding="20,24,20,0">
        <!-- Main content -->
        <Grid Grid.Row="0"
              RowDefinitions="Auto,Auto,*,Auto"
              RowSpacing="16">
            <!-- Back Button -->
            <ImageButton Source="back_green.png"
                         WidthRequest="20"
                         HeightRequest="20  "
                         HorizontalOptions="Start"
                         VerticalOptions="Start"
                         Margin="0,10,0,0"
                         Clicked="OnBackClicked"/>

            <!-- Header -->
            <VerticalStackLayout Spacing="0"
                                 Grid.Row="1"
                                 Margin="10,10,0,0">
                <Label FontFamily="AppFont"
                       FontSize="44"
                       TextColor="#8FB78F"
                       LineHeight="1.0">
                    <Label.Resources>
                        <Style TargetType="Span">
                            <Setter Property="FontFamily"
                                    Value="AppFont"/>
                            <Setter Property="FontSize"
                                    Value="44"/>
                            <Setter Property="TextColor"
                                    Value="#8FB78F"/>
                        </Style>
                    </Label.Resources>
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="Hey "/>
                            <Span Text="{Binding Username}"/>
                            <Span Text=","/>
                            <Span Text="&#10;"/>
                            <Span Text="how do you &#10;feeling today?"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </VerticalStackLayout>

            <!-- Spacer for small gap -->
            <BoxView Grid.Row="1"
                     HeightRequest="8"
                     Opacity="0"/>

            <!-- Mood grid -->
            <CollectionView Grid.Row="2"
                            ItemsSource="{Binding Moods}"
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedMood}"
                            Margin="0,4,0,0">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical"
                                     Span="2"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="8">
                            <Border BackgroundColor="White"
                                    StrokeThickness="0"
                                    Padding="16"
                                    HeightRequest="150"
                                    Grid.RowSpan="1">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="16"/>
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="Black"
                                            Opacity="0.12"
                                            Radius="10"
                                            Offset="0,4"/>
                                </Border.Shadow>
                                <Grid RowDefinitions="*,Auto"
                                      ColumnDefinitions="*"
                                      RowSpacing="8"
                                      VerticalOptions="Center">
                                    <!-- Mood image button -->
                                    <ImageButton Source="{Binding Icon}"
                                                 BackgroundColor="Transparent"
                                                 Aspect="AspectFit"
                                                 HeightRequest="120"
                                                 WidthRequest="120"
                                                 InputTransparent="True"
                                                 HorizontalOptions="Center"
                                                 VerticalOptions="Center"/>
                                    <Label Grid.Row="1"
                                           Text="{Binding Name}"
                                           FontSize="20"
                                           TextColor="#8FB78F"
                                           HorizontalOptions="Center"/>
                                </Grid>
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroupList>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal"/>
                                            <VisualState x:Name="Selected">
                                                <VisualState.Setters>
                                                    <Setter Property="BackgroundColor"
                                                            Value="#FFF3E1"/>
                                                    <Setter Property="Stroke"
                                                            Value="#4DA3FF"/>
                                                    <Setter Property="StrokeThickness"
                                                            Value="2"/>
                                                    <Setter Property="Shadow">
                                                        <Shadow Brush="Black"
                                                                Opacity="0.22"
                                                                Radius="14"
                                                                Offset="0,4"/>
                                                    </Setter>
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateGroupList>
                                </VisualStateManager.VisualStateGroups>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Next button -->
            <Button Grid.Row="3"
                    Text="Next"
                    FontSize="20"
                    Command="{Binding NextCommand}"
                    BackgroundColor="#FEAA3A"
                    TextColor="White"
                    CornerRadius="16"
                    HeightRequest="48"
                    FontAttributes="Bold"
                    IsEnabled="{Binding IsNextEnabled}"
                    Margin="0,8,0,0"/>
        </Grid>

    </Grid>
</ContentPage>